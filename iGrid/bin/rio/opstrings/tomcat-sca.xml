<?xml version="1.0" encoding="ISO-8859-1" standalone="no"?>
<!DOCTYPE opstring SYSTEM "java://org/jini/rio/dtd/rio_opstring.dtd" [
    <!ENTITY Local.IP SYSTEM "java://java.net.InetAddress.getLocalHost().getHostAddress()" >
    <!ENTITY Local.Port "9000" >
    <!ENTITY CodeServerURL "http://&Local.IP;:&Local.Port;/" >
]>

<opstring>
    <OperationalString Name="Load Balanced Tomcat Servers">

        <ServiceBean Name="Tomcat LB Service Control Adapter" MatchOnName="yes">
            <Codebase>&CodeServerURL;</Codebase>
            <Interfaces>
                <Interface>org.jini.rio.examples.sca.web.tomcat.TomcatSCAInterface</Interface>
                <Resources>
                    <JAR>tomcat-sca-dl.jar</JAR>
                    <JAR>rio-dl.jar</JAR>
                </Resources>
            </Interfaces>

            <ImplementationClass>org.jini.rio.examples.sca.web.tomcat.TomcatSCA
                <Resources>
                    <JAR>tomcat-sca.jar</JAR>
                    <JAR>rio.jar</JAR>
                </Resources>
            </ImplementationClass>
      
            <ServiceLevelAgreements>
                <SystemRequirements>
                    <Utilization ID="System" High=".9" />

                    <SystemComponent ClassName="org.jini.rio.qos.capability.enterprise.WebServerSupport">
                        <Attribute Name="Manufacturer" Value="Tomcat"/>
                        <Attribute Name="Version" Value="5.0.27"/>                        

                        <SoftwareLoad RemoveOnDestroy="no">
                            <Download Source="jakarta-tomcat-5.0.27.zip"
                                      InstallRoot="Tomcat-LB" Unarchive="yes">  
                                <Location>http://192.168.0.4:80/releases/</Location>
			    </Download>

                            <PostInstall RemoveOnCompletion="no">
                                <Download Source="tomcat-install.jar"
                                          InstallRoot="Tomcat-LB" Unarchive="no">
                                    <Location>http://192.168.0.4:80/releases/</Location>
			        </Download>
                                <ExecutionTarget Name="tomcat-install.jar" />
                            </PostInstall>                            

                        </SoftwareLoad>                        

                    </SystemComponent>

                </SystemRequirements>


            </ServiceLevelAgreements>

            <Groups>
                <Group>rio</Group>
            </Groups>

            <Maintain>1</Maintain>

            <Parameters>
                <Parameter Name="installRoot" Value="Tomcat-LB"/>
                <Parameter Name="tomcatDirectoryName" Value="jakarta-tomcat-5.0.27"/>
                <Parameter Name="responseURL" Value="http://localhost:8080"/>
                <Parameter Name="accessLogURL" Value="http://localhost:8080/watches/TomcatAccessLog"/>
                <Parameter Name="logFilnamePrefix" Value="localhost_access_log"/>
                <Parameter Name="samplePeriod" Value="5"/>
                <Parameter Name="loadBalancer" Value="true"/>
                <Parameter Name="serverPort" Value="8005"/>
                <Parameter Name="httpConnectorPort" Value="8080"/>
                <Parameter Name="ajpConnectorPort" Value="8009"/>
            </Parameters>  


            <Associations>
                <Association Type="uses" Name="Tomcat Service Control Adapter"  />
            </Associations>
          
            <Cluster>
                <Machine>192.168.0.4</Machine>
            </Cluster>

            <Comment>Tomcat Web Container SCA for load balancing</Comment>
        </ServiceBean>


        <ServiceBean Name="Tomcat Service Control Adapter" MatchOnName="yes">
            <Codebase>&CodeServerURL;</Codebase>
            <Interfaces>
                <Interface>org.jini.rio.examples.sca.web.tomcat.TomcatSCAInterface</Interface>
                <Resources>
                    <JAR>tomcat-sca-dl.jar</JAR>
                    <JAR>rio-dl.jar</JAR>
                </Resources>
            </Interfaces>

            <ImplementationClass>org.jini.rio.examples.sca.web.tomcat.TomcatSCA
                <Resources>
                    <JAR>tomcat-sca.jar</JAR>
                    <JAR>rio.jar</JAR>
                </Resources>
            </ImplementationClass>
      
            <ServiceLevelAgreements>
                <SystemRequirements>
                    <Utilization ID="System" High=".9" />

                    <SystemComponent ClassName="org.jini.rio.qos.capability.enterprise.WebServerSupport">
                        <Attribute Name="Manufacturer" Value="Tomcat"/>
                        <Attribute Name="Version" Value="5.0.27"/>                        

                        <SoftwareLoad RemoveOnDestroy="no">
                            <Download Source="jakarta-tomcat-5.0.27.zip"
                                      InstallRoot="Tomcat" Unarchive="yes"> 
                                 <Location>http://192.168.0.4:80/releases/</Location>
			     </Download>

                            <PostInstall RemoveOnCompletion="no">
                                <Download Source="tomcat-install.jar"
                                          InstallRoot="Tomcat" Unarchive="no">
                                    <Location>http://192.168.0.4:80/releases/</Location>
			        </Download>
                                <ExecutionTarget Name="tomcat-install.jar" />
                            </PostInstall>                            

                        </SoftwareLoad>                        

                    </SystemComponent>

                </SystemRequirements>

                <SLA ID="Byte Counter" High="50000" >
                    <Configuration>
                        <Component Name="org.jini.rio.qos.SLAPolicyHandler">
                            <Parameter Name="slaPolicyHandler" 
                                Value="new org.jini.rio.qos.ScalingPolicyHandler(
                                                                 (org.jini.rio.core.SLA)$data)" />
                        </Component>
                        <Component Name="org.jini.rio.qos.ScalingPolicyHandler">
                            <Parameter Name="MaxServices" Value="2" />
                            <Parameter Name="ServiceDiscoveryWait" Value="2000" />
                        </Component>
                    </Configuration>
                </SLA>

                <SLA ID="Hit Counter" Low="2" High="7" >
                    <Configuration>
                        <Component Name="org.jini.rio.qos.SLAPolicyHandler">
                            <Parameter Name="slaPolicyHandler" 
                                       Value="new org.jini.rio.qos.ScalingPolicyHandler(
                                                                 (org.jini.rio.core.SLA)$data)" />
                        </Component>
                        <Component Name="org.jini.rio.qos.ScalingPolicyHandler">                            
                            <Parameter Name="MaxServices" Value="2" />
                            <Parameter Name="LowerThresholdDampeningFactor" Value="30000" />
                            <Parameter Name="ServiceDiscoveryWait" Value="2000" />
                        </Component>
                    </Configuration>
                </SLA>

                <SLA ID="Response Timer" High="1000" >
                    <Configuration>
                        <Component Name="org.jini.rio.qos.SLAPolicyHandler">
                            <Parameter Name="slaPolicyHandler" 
                                       Value="new org.jini.rio.qos.ScalingPolicyHandler(
                                                                 (org.jini.rio.core.SLA)$data)" />
                        </Component>
                        <Component Name="org.jini.rio.qos.ScalingPolicyHandler">                            
                            <Parameter Name="MaxServices" Value="2" />
                            <Parameter Name="ServiceDiscoveryWait" Value="2000" />
                        </Component>
                    </Configuration>
                </SLA>

            </ServiceLevelAgreements>

            <Groups>
                <Group>rio</Group>
            </Groups>
<!--
            <Cluster>
                <Machine>192.168.0.6</Machine>
            </Cluster>
-->

            <Maintain>1</Maintain>
            
            <MaxPerMachine>1</MaxPerMachine>

            <Parameters>
                <Parameter Name="installRoot" Value="Tomcat"/>
                <Parameter Name="tomcatDirectoryName" Value="jakarta-tomcat-5.0.27"/>
                <Parameter Name="responseURL" Value="http://localhost:8081"/>
                <Parameter Name="accessLogURL" Value="http://localhost:8081/watches/TomcatAccessLog"/>
                <Parameter Name="logFilnamePrefix" Value="localhost_access_log"/>
                <Parameter Name="samplePeriod" Value="5"/>
                <Parameter Name="loadBalancer" Value="false"/>
                <Parameter Name="serverPort" Value="9005"/>
                <Parameter Name="httpConnectorPort" Value="8081"/>
                <Parameter Name="ajpConnectorPort" Value="9009"/>
            </Parameters>            

            <Associations>
                <Association Type="requires" Name="Tomcat LB Service Control Adapter"  />
            </Associations>


            <Comment>Tomcat Web Container SCA</Comment>
        </ServiceBean>

    </OperationalString>
</opstring>
