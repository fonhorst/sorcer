<?xml version='1.0' encoding='ISO-8859-1' standalone='yes'?>
<!-- 
 * Copyright 2010 the original author or authors.
 * Copyright 2010 SorcerSoft.org.
 *  
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * Service-Oriented Computing Environmet: iGrid all build configuration
 * Make sure the following variables are changed to reflect your environment:
 *    IGRID_HOME        iGrid location
 *    JAVA_HOME         JDK location
 *    ANT_HOME          Apache Ant location
 Please see also the <module name>-build.xml files in modules that import this file.
-->

<project name="iGrid" default="all" basedir=".">

	<property environment="env" />
	<property name="iGrid.home" value="${env.IGRID_HOME}" />
		
	<target name="doIt">
		<antcall target="doOne">
			<param name="dir" location="modules/sorcer" />
			<param name="antfile" value="sorcer-build.xml" />
		</antcall>

		<antcall target="doOne">
			<param name="dir" location="modules/engineering" />
			<param name="antfile" value="engineering-build.xml" />
		</antcall>

		<!-- Add your module here. Please use the same antcall syntax as
		all the other modules-->
	</target>

	<target name="modules">
		<ant target="doIt" antfile="iGrid-build.xml" />
	</target>

	<target name="clean">
		<property name="target" value="clean" />
		<ant target="doIt" antfile="iGrid-build.xml" />
	</target>

	<target name="all" depends="prepare, clean-logs">
		<property name="target" value="all" />
		<ant target="doIt" antfile="iGrid-build.xml" />
	</target>

	<target name="all-test" depends="prepare, clean-logs">
		<!-- Build iGrid with SORCER and engineering JUnit tests -->
		<ant antfile="sorcer-build.xml" dir="${iGrid.home}/modules/sorcer" target="all-test" inheritAll="false" />
		<ant antfile="engineering-build.xml" dir="${iGrid.home}/modules/engineering" target="all-test" inheritAll="false" />
	</target>

	<target name="compile" depends="prepare">
		<property name="target" value="compileSources" />
		<ant target="doIt" antfile="iGrid-build.xml" />
	</target>

	<target name="jars" depends="prepare">
		<property name="target" value="jars" />
		<ant target="doIt" antfile="iGrid-build.xml" />
	</target>

	<target name="rebuild" depends="clean, modules">
	</target>

	<target name="doOne">
		<condition property="whichone" value="doWith">
			<isset property="target" />
		</condition>
		<condition property="whichone" value="doWithOut">
			<not>
				<isset property="target" />
			</not>
		</condition>
		<ant target="${whichone}" antfile="iGrid-build.xml" />
	</target>

	<target name="doWith">
		<ant dir="${dir}" antfile="${antfile}" target="${target}" inheritAll="true" />
	</target>

	<target name="doWithOut">
		<ant dir="${dir}" antfile="${antfile}" inheritAll="true" />
	</target>

	<target name="delete-code" description="Deletes classes and jars in the iGrid project">
		<delete dir="classes" />
		<delete dir="lib/local" />
		<delete dir="lib/eng" />
		<mkdir dir="classes" />
		<mkdir dir="lib/eng" />
		<mkdir dir="lib/local" />
		<mkdir dir="lib" />
	</target>

	<target name="clean-logs">
		<delete includeemptydirs="true">
			<fileset dir="bin/logs" includes="**/*" />
		</delete>
		<delete includeemptydirs="true">
			<fileset dir="bin/browser/logs" includes="**/*" />
		</delete>
		<delete includeemptydirs="true">
			<fileset dir="bin/blitz/logs" includes="**/*" />
		</delete>
		<delete includeemptydirs="true">
			<fileset dir="logs/remote" includes="**/*" />
		</delete>
		<mkdir dir="logs/remote/sorcer" />
	</target>

	<target name="clean-sorcer-classes">
		<delete includeemptydirs="true">
			<fileset dir="classes/sorcer" includes="**/*" />
		</delete>
		<delete includeemptydirs="true">
			<fileset dir="lib/sorcer/lib" includes="**/*" />
		</delete>
		<delete includeemptydirs="true">
			<fileset dir="lib/sorcer/lib-dl" includes="**/*" />
		</delete>
	</target>

	<target name="clean-eng-classes">
		<delete includeemptydirs="true">
			<fileset dir="classes/engineering" includes="**/*" />
		</delete>
		<delete includeemptydirs="true">
			<fileset dir="lib/eng/lib" includes="**/*" />
		</delete>
		<delete includeemptydirs="true">
			<fileset dir="lib/eng/lib-dl" includes="**/*" />
		</delete>
	</target>

	<target name="clean-classes">
		<delete includeemptydirs="true">
			<fileset dir="classes" includes="**/*" />
		</delete>
		<delete includeemptydirs="true">
			<fileset dir="lib/sorcer/lib" includes="**/*" />
		</delete>
		<delete includeemptydirs="true">
			<fileset dir="lib/sorcer/lib-dl" includes="**/*" />
		</delete>
		<delete includeemptydirs="true">
			<fileset dir="lib/eng/lib" includes="**/*" />
		</delete>
		<delete includeemptydirs="true">
			<fileset dir="lib/eng/lib-dl" includes="**/*" />
		</delete>
	</target>

	<target name="delete-subversion-metadata">
		<delete includeemptydirs="true">
			<fileset dir="../modules" includes="**/.svn" defaultexcludes="false" />
		</delete>
	</target>

	<target name="prepare">
		<mkdir dir="bin/logs" />
		<mkdir dir="bin/browser/logs" />
		<mkdir dir="bin/blitz/logs" />
		<mkdir dir="bin/sorcer" />
		<mkdir dir="bin/examples" />
		<mkdir dir="configs" />
		<mkdir dir="policy" />
		<mkdir dir="lib" />
		<mkdir dir="lib/sorcer/lib" />
		<mkdir dir="lib/sorcer/lib-dl" />
		<mkdir dir="lib/sorcer/lib-ext" />
		<mkdir dir="lib/eng" />
		<mkdir dir="lib/eng/lib" />
		<mkdir dir="lib/eng/lib-dl" />
		<mkdir dir="lib/eng/lib-ext" />
		<mkdir dir="lib/local" />
		<mkdir dir="docs" />
		<mkdir dir="reports" />
		<mkdir dir="classes" />
		<mkdir dir="logs/remote/sorcer" />
	</target>

</project>
